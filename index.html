<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBDown任务管理器</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="bbdown_icon.svg" type="image/svg+xml">
</head>
<body>
    <div class="container">
        <!-- 顶部连接控制栏 -->
        <div class="connection-controls">
            <div class="connection-group">
                <h3>连接设置</h3>
                <div class="connection-form">
                    <label>主机:</label>
                    <input type="text" id="host-input" value="localhost" placeholder="localhost">
                    <label>端口:</label>
                    <input type="number" id="port-input" value="58682" placeholder="58682">
                    <button id="connect-btn" class="btn btn-primary">
                        <span class="icon">🔗</span> 连接
                    </button>
                    <div class="connection-status" id="connection-status">
                        <span class="status-indicator offline"></span>
                        <span class="status-text">未连接</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 选项卡容器 -->
        <div class="tabs-container">
            <div class="tab-headers">
                <button class="tab-header active" data-tab="dashboard">任务仪表盘</button>
                <button class="tab-header" data-tab="add-task">添加任务</button>
                <button class="tab-header" data-tab="manage">任务管理</button>
            </div>

            <!-- 任务仪表盘 -->
            <div class="tab-content active" id="dashboard">
                <div class="dashboard-controls">
                    <button id="refresh-btn" class="btn btn-secondary">
                        <span class="icon">🔄</span> 刷新任务
                    </button>
                    <div class="auto-refresh">
                        <label>
                            <input type="checkbox" id="auto-refresh" checked>
                            自动刷新 (10秒)
                        </label>
                    </div>
                </div>

                <div class="tasks-container">
                    <div class="task-section">
                        <h3>运行中任务</h3>
                        <div class="table-container">
                            <table id="running-tasks-table" class="task-table">
                                <thead>
                                    <tr>
                                        <th>AID</th>
                                        <th>标题</th>
                                        <th>创建时间</th>
                                        <th>进度</th>
                                        <th>速度</th>
                                        <th>大小</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                            <div class="empty-state" id="running-empty">
                                <span class="icon">📋</span>
                                <p>暂无运行中的任务</p>
                            </div>
                        </div>
                    </div>

                    <div class="task-section">
                        <h3>已完成任务</h3>
                        <div class="table-container">
                            <table id="finished-tasks-table" class="task-table">
                                <thead>
                                    <tr>
                                        <th>AID</th>
                                        <th>标题</th>
                                        <th>创建时间</th>
                                        <th>完成时间</th>
                                        <th>进度</th>
                                        <th>大小</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                            <div class="empty-state" id="finished-empty">
                                <span class="icon">✅</span>
                                <p>暂无已完成的任务</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 添加任务 -->
            <div class="tab-content" id="add-task">
                <div class="options-form">
                    <!-- 基本选项 -->
                    <div class="option-group">
                        <div class="group-header" data-group="basic">
                            <span class="toggle-icon">▶</span>
                            <h3>基本选项</h3>
                        </div>
                        <div class="group-content" id="basic-options">
                            <div class="form-row">
                                <label for="url-input">视频URL:</label>
                                <input type="text" id="url-input" placeholder="输入BV/av/ep/ss号或视频URL" required>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="only-show-info">
                                    仅显示信息（不下载）
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="show-all">
                                    显示所有信息（包括隐藏流）
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="interactive">
                                    交互模式（手动选择）
                                </label>
                            </div>
                            <div class="form-row">
                                <label for="area-select">区域设置:</label>
                                <select id="area-select">
                                    <option value="">默认</option>
                                    <option value="大陆">大陆</option>
                                    <option value="港澳台">港澳台</option>
                                    <option value="泰国">泰国</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label for="language-input">语言:</label>
                                <input type="text" id="language-input" placeholder="如: zh-Hans">
                            </div>
                            <div class="form-row">
                                <label for="delay-input">分页延迟(ms):</label>
                                <input type="number" id="delay-input" value="0" min="0" max="10000">
                            </div>
                        </div>
                    </div>

                    <!-- API选项 -->
                    <div class="option-group">
                        <div class="group-header" data-group="api">
                            <span class="toggle-icon">▶</span>
                            <h3>API选项</h3>
                        </div>
                        <div class="group-content" id="api-options">
                            <div class="form-row">
                                <label>
                                    <input type="radio" name="api-type" id="api-tv" value="tv">
                                    使用TV API
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="radio" name="api-type" id="api-app" value="app">
                                    使用App API
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="radio" name="api-type" id="api-intl" value="intl">
                                    使用国际版API
                                </label>
                            </div>
                            <div class="form-row">
                                <label for="tv-host-input">TV API主机:</label>
                                <input type="text" id="tv-host-input" value="api.snm0516.aisee.tv">
                            </div>
                        </div>
                    </div>

                    <!-- 内容选择 -->
                    <div class="option-group">
                        <div class="group-header" data-group="content">
                            <span class="toggle-icon">▶</span>
                            <h3>内容选择</h3>
                        </div>
                        <div class="group-content" id="content-options">
                            <div class="form-row">
                                <label>
                                    <input type="radio" name="content-type" id="video-only" value="video">
                                    仅下载视频
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="radio" name="content-type" id="audio-only" value="audio">
                                    仅下载音频
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="danmaku-only">
                                    仅下载弹幕
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="cover-only">
                                    仅下载封面
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="sub-only">
                                    仅下载字幕
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="download-danmaku">
                                    下载弹幕
                                </label>
                            </div>
                            <div class="form-row">
                                <label for="danmaku-formats">弹幕格式:</label>
                                <input type="text" id="danmaku-formats" placeholder="如: xml,ass 用逗号分隔">
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="skip-ai" checked>
                                    跳过AI生成字幕
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 下载控制 -->
                    <div class="option-group">
                        <div class="group-header" data-group="control">
                            <span class="toggle-icon">▶</span>
                            <h3>下载控制</h3>
                        </div>
                        <div class="group-content" id="control-options">
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="multi-thread" checked>
                                    多线程下载
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="use-mp4box">
                                    使用MP4box封装
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="use-aria2c">
                                    使用aria2c下载
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="simply-mux">
                                    简单混流（减少处理）
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="skip-mux">
                                    跳过混流步骤
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="skip-subtitle">
                                    跳过字幕下载
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="skip-cover">
                                    跳过封面下载
                                </label>
                            </div>
                            <div class="form-row">
                                <label for="encoding-priority">编码优先级:</label>
                                <input type="text" id="encoding-priority" placeholder="如: hevc,av1,avc">
                            </div>
                            <div class="form-row">
                                <label for="dfn-priority">画质优先级:</label>
                                <input type="text" id="dfn-priority" placeholder="如: 1080p,720p">
                            </div>
                            <div class="form-row">
                                <label for="select-page">分页选择:</label>
                                <input type="text" id="select-page" placeholder="如: 1-5,8">
                            </div>
                        </div>
                    </div>

                    <!-- 文件命名 -->
                    <div class="option-group">
                        <div class="group-header" data-group="file">
                            <span class="toggle-icon">▶</span>
                            <h3>文件命名</h3>
                        </div>
                        <div class="group-content" id="file-options">
                            <div class="form-row">
                                <label for="file-pattern">文件命名模式:</label>
                                <input type="text" id="file-pattern" placeholder="如: <videoTitle>[<dfn>]">
                            </div>
                            <div class="form-row">
                                <label for="multi-file-pattern">多P文件命名:</label>
                                <input type="text" id="multi-file-pattern" placeholder="如: P<pageNumber>_<videoTitle>">
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="add-dfn-subfix">
                                    添加画质后缀
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="no-padding-page">
                                    不补齐页码位数
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 路径设置 -->
                    <div class="option-group">
                        <div class="group-header" data-group="path">
                            <span class="toggle-icon">▶</span>
                            <h3>路径设置</h3>
                        </div>
                        <div class="group-content" id="path-options">
                            <div class="form-row">
                                <label for="work-dir">工作目录:</label>
                                <input type="text" id="work-dir" placeholder="下载文件保存路径">
                            </div>
                            <div class="form-row">
                                <label for="ffmpeg-path">FFmpeg路径:</label>
                                <input type="text" id="ffmpeg-path" placeholder="FFmpeg可执行文件路径">
                            </div>
                            <div class="form-row">
                                <label for="mp4box-path">MP4box路径:</label>
                                <input type="text" id="mp4box-path" placeholder="MP4box可执行文件路径">
                            </div>
                            <div class="form-row">
                                <label for="aria2c-path">Aria2c路径:</label>
                                <input type="text" id="aria2c-path" placeholder="Aria2c可执行文件路径">
                            </div>
                        </div>
                    </div>

                    <!-- 网络设置 -->
                    <div class="option-group">
                        <div class="group-header" data-group="network">
                            <span class="toggle-icon">▶</span>
                            <h3>网络设置</h3>
                        </div>
                        <div class="group-content" id="network-options">
                            <div class="form-row">
                                <label for="user-agent">User Agent:</label>
                                <input type="text" id="user-agent" placeholder="自定义User Agent">
                            </div>
                            <div class="form-row">
                                <label for="cookie">Cookie:</label>
                                <input type="text" id="cookie" placeholder="登录Cookie">
                            </div>
                            <div class="form-row">
                                <label for="access-token">Access Token:</label>
                                <input type="text" id="access-token" placeholder="访问令牌">
                            </div>
                            <div class="form-row">
                                <label for="host-input-network">主机:</label>
                                <input type="text" id="host-input-network" placeholder="自定义主机">
                            </div>
                            <div class="form-row">
                                <label for="ep-host-input">EP主机:</label>
                                <input type="text" id="ep-host-input" placeholder="EP API主机">
                            </div>
                            <div class="form-row">
                                <label for="upos-host">UPOS主机:</label>
                                <input type="text" id="upos-host" placeholder="UPOS主机">
                            </div>
                            <div class="form-row">
                                <label for="aria2c-args">Aria2c参数:</label>
                                <input type="text" id="aria2c-args" placeholder="额外的Aria2c参数">
                            </div>
                            <div class="form-row">
                                <label for="aria2c-proxy">Aria2c代理:</label>
                                <input type="text" id="aria2c-proxy" placeholder="代理设置">
                            </div>
                        </div>
                    </div>

                    <!-- 高级设置 -->
                    <div class="option-group">
                        <div class="group-header" data-group="advanced">
                            <span class="toggle-icon">▶</span>
                            <h3>高级设置</h3>
                        </div>
                        <div class="group-content" id="advanced-options">
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="debug">
                                    调试模式
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="force-http">
                                    强制使用HTTP
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="allow-pcdn">
                                    允许PCDN
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="force-replace-host">
                                    强制替换主机
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="save-archives">
                                    保存归档到文件
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="video-asc">
                                    视频升序排列
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="audio-asc">
                                    音频升序排列
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="checkbox" id="bandwidth-asc">
                                    带宽升序排列
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 兼容性选项 -->
                    <div class="option-group">
                        <div class="group-header" data-group="compat">
                            <span class="toggle-icon">▶</span>
                            <h3>兼容性选项</h3>
                        </div>
                        <div class="group-content" id="compat-options">
                            <div class="form-row">
                                <label>
                                    <input type="radio" name="codec-type" id="only-hevc" value="hevc">
                                    仅HEVC编码
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="radio" name="codec-type" id="only-avc" value="avc">
                                    仅AVC编码
                                </label>
                            </div>
                            <div class="form-row">
                                <label>
                                    <input type="radio" name="codec-type" id="only-av1" value="av1">
                                    仅AV1编码
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="add-task-controls">
                    <button id="add-task-btn" class="btn btn-primary btn-large">
                        <span class="icon">➕</span> 添加任务
                    </button>
                </div>
            </div>

            <!-- 任务管理 -->
            <div class="tab-content" id="manage">
                <div class="manage-controls">
                    <div class="batch-operations">
                        <h3>批量操作</h3>
                        <div class="button-group">
                            <button id="remove-all-btn" class="btn btn-danger">
                                <span class="icon">🗑️</span> 移除所有已完成任务
                            </button>
                            <button id="remove-failed-btn" class="btn btn-warning">
                                <span class="icon">⚠️</span> 移除所有失败任务
                            </button>
                        </div>
                    </div>

                    <div class="single-operation">
                        <h3>按AID移除</h3>
                        <div class="aid-form">
                            <input type="text" id="aid-input" placeholder="输入要移除的任务AID">
                            <button id="remove-by-aid-btn" class="btn btn-danger">
                                <span class="icon">🗑️</span> 移除任务
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 任务详情模态框 -->
    <div id="task-detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>任务详情</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="task-detail-content">
                <!-- 任务详情内容将在这里动态填充 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">关闭</button>
            </div>
        </div>
    </div>

    <!-- 加载指示器 -->
    <div id="loading-indicator" class="loading">
        <div class="spinner"></div>
        <p>正在处理...</p>
    </div>

    <!-- 通知容器 -->
    <div id="notification-container"></div>

    <script src="script.js"></script>
</body>
</html>